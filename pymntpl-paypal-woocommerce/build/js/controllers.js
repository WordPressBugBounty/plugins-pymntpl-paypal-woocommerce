/*! For license information please see controllers.js.LICENSE.txt */
(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{BaseController:()=>P,CartController:()=>W,CheckoutController:()=>ct,ExpressCheckoutController:()=>bt,MiniCartController:()=>jt,ProductController:()=>B});const n=window.jQuery;var r=t.n(n);const i=window.wp.apiFetch;var o=t.n(i);const a=window.wcPPCP.utils,c=window.lodash;var u=["email","phone"],s=["phone"];function l(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const d=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.context=e,this.controller=n}var e,n;return e=t,n=[{key:"populate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(this.context.isCheckout()||this.context.isExpressCheckout())&&this.syncDOMToMap(e),null!=t&&t.billing&&this.populateBilling(t.billing,e),null!=t&&t.shipping&&!e.skipShipping&&e.needsShipping&&this.populateShipping(t.shipping,e)}},{key:"syncDOMToMap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=["first_name","last_name","company","address_1","address_2","city","state","postcode","country","email","phone"];if(e.forEach((function(t){var e=r()('[name="billing_'.concat(t,'"]'));e.length&&(0,a.setFieldValue)(t,e.val(),"billing")})),t.needsShipping){var n=["first_name","last_name","company","address_1","address_2","city","state","postcode","country","phone"];n.forEach((function(t){var e=r()('[name="shipping_'.concat(t,'"]'));e.length&&(0,a.setFieldValue)(t,e.val(),"shipping")}))}}},{key:"populateBilling",value:function(t,e){var n=this,i=t.email,o=t.phone,s=l(t,u);(0,c.isEmpty)(s)||(this.context.isCheckout()||this.context.isExpressCheckout()?(0,a.isValidAddress)(s,["first_name","last_name","phone"])&&!(0,c.isEqual)(this.controller.getCartAddress("billing",!0),(0,c.omit)(s,["first_name","last_name"]))&&(this.controller.update_required=!0,this.populateAddressFields(s,"billing"),r()(document.body).one("updated_checkout",(function(){n.populateAddressFields(s,"billing")}))):this.populateAddressFields(s,"billing")),i&&(this.context.isCheckout()&&(0,a.isValid)("billing_email")||(0,a.setFieldValue)("billing_email",i)),o&&((0,a.setFieldValue)("billing_phone",o),e.needsShipping&&(0,a.setFieldValue)("shipping_phone",o))}},{key:"populateShipping",value:function(t,e){var n=this,i=t.phone,o=l(t,s);if(!(0,c.isEmpty)(o))if(this.context.isCheckout()||this.context.isExpressCheckout()){var u=this.controller.getCartFullAddress("shipping",!0);(0,c.isEqual)(u,o)||(this.controller.update_required=!0,this.populateAddressFields(o,"shipping"),r()(document.body).one("updated_checkout",(function(){n.populateAddressFields(o,"shipping")}))),(0,a.isValidAddress)(this.controller.getCartFullAddress("billing",!0),["phone","email"])||(o.first_name&&o.last_name&&!(0,a.isValid)("billing_first_name")&&!(0,a.isValid)("billing_last_name")&&((0,a.setFieldValue)("first_name",o.first_name,"billing"),(0,a.setFieldValue)("last_name",o.last_name,"billing")),this.populateAddressFields(o,"billing"))}else this.populateAddressFields(o,"shipping"),(0,a.isValidAddress)(this.controller.getCartFullAddress("billing",!0),["phone","email"])||this.populateAddressFields(o,"billing");i&&(0,a.setFieldValue)("shipping_phone",i),(this.context.isCheckout()||this.context.isExpressCheckout())&&this.maybeShipToDifferentAddress()}},{key:"maybeShipToDifferentAddress",value:function(){var t;if(null!==(t=r()('[name="ship_to_different_address"]'))&&void 0!==t&&t.length){var e=this.controller.getCartFullAddress("billing"),n=this.controller.getCartFullAddress("shipping"),i=!(0,c.isEqual)(e,n);r()('[name="ship_to_different_address"]').prop("checked",i).trigger("change")}}},{key:"populateAddressFields",value:function(t,e){for(var n in t)(0,a.setFieldValue)(n,t[n],e)}}],n&&h(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),p=window.wcPPCP.actions;var f=t.n(p);function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){k(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(){g=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new E(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var c=k(a,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function h(){}function d(){}function p(){}var f={};c(f,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(x([])));m&&m!==e&&n.call(m,i)&&(f=m);var b=p.prototype=h.prototype=Object.create(f);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(i,o,a,c){var u=s(t[i],t,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==y(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;this._invoke=function(t,n){function o(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(o,o):o()}}function k(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function x(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=p,c(b,"constructor",p),c(p,"constructor",d),d.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(_.prototype),c(_.prototype,o,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new _(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),c(b,a,"Generator"),c(b,i,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=x,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:x(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function b(t,e,n,r,i,o,a){try{var c=t[o](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,i)}function w(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){b(o,r,i,a,c,"next",t)}function c(t){b(o,r,i,a,c,"throw",t)}a(void 0)}))}}function _(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function k(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var P=function(){function t(e){var n=e.id,r=e.settings,i=e.cart,o=e.context,a=e.gateway,c=e.container,u=void 0===c?null:c,s=e.paymentElementSelector,l=void 0===s?null:s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=n,this.cart=i,this.gateway=a,this.context=o,this.settings=r,this.container=u||"li.payment_method_".concat(n),this.paymentElementSelector=l,this.order_field_key=a.getOrderFieldKey(),this.billing_token_key=a.getTokenFieldKey(),this.isPaymentMethodAvailable=!0,this.fields=new d(this.context,this),this.actions=new(f()),this.gateway.setController(this),this.gateway.initialize()}var e,n,i,c;return e=t,n=[{key:"initialize",value:function(){var t=this;this.loadPayPalScript().then(w(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createPaymentElement();case 2:case"end":return e.stop()}}),e)}))))}},{key:"loadPayPalScript",value:function(){var t=this;return new Promise((function(e,n){(0,a.loadPayPalSdk)(t.getPayPalSDKArgs()).then((function(n){t.paypal=n,t.gateway.setPayPal(n),e()})).catch((function(e){console.log(e),null!=e&&e.code&&t.submitError((0,a.getErrorMessage)(e)),n()}))}))}},{key:"getPayPalSDKArgs",value:function(){return(0,a.getPayPalQueryParams)()}},{key:"createPaymentElement",value:(c=w(g().mark((function t(){var e,n,i,o;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.configurationError=null,this.cart.isPaymentMethodAvailable(this.gateway.id)){t.next=5;break}return this.isPaymentMethodAvailable=!1,this.onPaymentUnavailable(),t.abrupt("return");case 5:return e=!1,t.prev=6,t.next=9,this.gateway.canMakePayment();case 9:e=t.sent,t.next=16;break;case 12:t.prev=12,t.t0=t.catch(6),e=!1,t.t0 instanceof a.ConfigurationError?this.configurationError=t.t0.message:console.error("Payment method availability check failed:",t.t0);case 16:if(e){t.next=20;break}return this.isPaymentMethodAvailable=!1,this.onPaymentUnavailable(),t.abrupt("return");case 20:if(this.isPaymentMethodAvailable=!0,n=this.getElementContainer()){t.next=24;break}return t.abrupt("return");case 24:if(!this.gateway.shouldCreateElement(n)){t.next=40;break}if(!(n instanceof NodeList)){t.next=36;break}i=0;case 27:if(!(i<n.length)){t.next=34;break}return o=n[i],t.next=31,this.gateway.createPaymentElement(o);case 31:i++,t.next=27;break;case 34:t.next=38;break;case 36:return t.next=38,this.gateway.createPaymentElement(n);case 38:this.$paymentElement=r()(n),this.onPaymentElementReady();case 40:case"end":return t.stop()}}),t,this,[[6,12]])}))),function(){return c.apply(this,arguments)})},{key:"getPaymentElement",value:function(){return this.$paymentElement}},{key:"destroyPaymentElement",value:function(){var t,e;null===(t=(e=this.gateway).destroyPaymentElement)||void 0===t||t.call(e)}},{key:"disablePaymentElement",value:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===(t=(e=this.gateway).disablePaymentElement)||void 0===t||t.call(e),n&&null!=this&&this.$paymentElement&&this.$paymentElement.addClass("disabled")}},{key:"enablePaymentElement",value:function(){var t,e;null===(t=(e=this.gateway).enablePaymentElement)||void 0===t||t.call(e),this.$paymentElement&&this.$paymentElement.removeClass("disabled")}},{key:"displayPaymentElement",value:function(){var t;null===(t=this.getPaymentElement())||void 0===t||t.show()}},{key:"hidePaymentElement",value:function(){var t;null===(t=this.getPaymentElement())||void 0===t||t.hide()}},{key:"needsShipping",value:function(){return this.cart.needsShipping()}},{key:"getElementContainer",value:function(){return null}},{key:"onPaymentUnavailable",value:function(){this.actions.doAction("payment_unavailable",this)}},{key:"onPaymentElementReady",value:function(){this.actions.doAction("payment_element_ready",this)}},{key:"onCancel",value:function(){this.enablePaymentElement()}},{key:"onError",value:function(t,e){this.currentError?(this.submitError(this.currentError),this.currentError=null):this.submitError(t),this.enablePaymentElement(),r()(document.body).triggerHandler("wc_ppcp_on_error",[this,e,t])}},{key:"fetchBillingToken",value:function(t){return o()({method:"GET",path:"/wc-ppcp/v1/billing-agreement/token/".concat(t)})}},{key:"createPaymentToken",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o()({method:"POST",path:"/wc-ppcp/v1/vault/payment-tokens",data:m({setup_token:t},e)})}},{key:"createOrder",value:function(t,e){var n=this;return this.cart.createOrder(m(m({},t),{},{payment_method:this.id})).catch((function(t){return n.currentError=t,t}))}},{key:"createVaultSetupToken",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.disablePaymentElement(!0),o()({method:"POST",url:(0,a.getRestPath)("/wc-ppcp/v1/vault/setup-tokens"),data:m({context:this.context.getPage(),payment_method:this.id},e)}).then((function(t){return t.id})).catch((function(e){throw t.currentError=e,t.enablePaymentElement(),e}))}},{key:"onShippingChange",value:function(t){return this.cart.updateShipping(m(m({},t),{},{payment_method:this.id})).then((function(t){return t})).catch((function(t){throw t}))}},{key:"onBillingChange",value:function(t){return this.cart.updateBilling(m({payment_method:this.id},t)).then((function(t){return t})).catch((function(t){throw t}))}},{key:"submitError",value:function(t){}},{key:"getShippingPrefix",value:function(){return"shipping"}},{key:"getCartAddress",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{address_1:(0,a.getFieldValue)("address_1",t,e),address_2:(0,a.getFieldValue)("address_2",t,e),state:(0,a.getFieldValue)("state",t,e),city:(0,a.getFieldValue)("city",t,e),postcode:(0,a.getFieldValue)("postcode",t,e),country:(0,a.getFieldValue)("country",t,e)}}},{key:"getCartFullAddress",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{first_name:(0,a.getFieldValue)("first_name",t,e),last_name:(0,a.getFieldValue)("last_name",t,e),address_1:(0,a.getFieldValue)("address_1",t,e),address_2:(0,a.getFieldValue)("address_2",t,e),state:(0,a.getFieldValue)("state",t,e),city:(0,a.getFieldValue)("city",t,e),postcode:(0,a.getFieldValue)("postcode",t,e),country:(0,a.getFieldValue)("country",t,e)}}},{key:"onClick",value:function(){this.storeAttributionValues()}},{key:"validate",value:(i=w(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",!0);case 1:case"end":return t.stop()}}),t)}))),function(){return i.apply(this,arguments)})},{key:"populateCheckoutFields",value:function(t){var e=this.actions.applyFilters("field_population_options",{skipShipping:!1,needsShipping:this.needsShipping()},this);this.fields.populate(t,e),this.actions.doAction("after_populate_checkout_fields",this)}},{key:"submit",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e&&this.populateCheckoutFields(e),this.showProcessing(),o()({method:"POST",url:(0,a.getRestRoute)("cart/checkout"),data:this.getCartCheckoutData()}).then((function(e){if(e.result&&"success"==e.result)window.location=e.redirect;else if(e.messages)return t.submitError(e.messages)})).catch((function(e){e.code&&t.submitError(e.message)}))}},{key:"getCartCheckoutData",value:function(){return m({payment_method:this.id,context:this.context.getPage()},(0,a.fieldsToJson)())}},{key:"getProcessingSelector",value:function(){return"body"}},{key:"showProcessing",value:function(){var t;null===(t=r()(this.getProcessingSelector()))||void 0===t||t.block({message:this.getProcessingMessage(),overlayCSS:{background:"#fff",opacity:.6}})}},{key:"hideProcessing",value:function(){var t;null===(t=r()(this.getProcessingSelector()))||void 0===t||t.unblock()}},{key:"getProcessingMessage",value:function(){return'<div class="wc-ppcp-loader">\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                      </div>'}},{key:"getFullName",value:function(t){var e=[(0,a.getFieldValue)("first_name",t),(0,a.getFieldValue)("last_name",t)].filter(Boolean);return 0==e.length?null:1==e.length?e[0]:"".concat(e[0]," ").concat(e[1])}},{key:"updateGatewaySettings",value:function(t){var e="".concat(this.id,"_data");t[e]&&(this.gateway.settings=m(m({},this.gateway.settings),t[e]))}},{key:"isOrderAttributionEnabled",value:function(){return"undefined"!=typeof wc_order_attribution&&null!==document.querySelector("wc-order-attribution-inputs")}},{key:"storeAttributionValues",value:function(){if(!t.attributionDataStored&&!this.context.isCheckout()&&this.isOrderAttributionEnabled()){var e=wc_order_attribution.params.prefix;r()('input[type="hidden"][name^="'+e+'"]').each((function(t,e){var n=r()(e),i=n.attr("name");(0,a.setFieldValue)(i,n.val(),null)})),t.attributionDataStored=!0}}},{key:"getLineItems",value:function(){return this.cart.getLineItems()}},{key:"getShippingOptions",value:function(){return this.cart.getShippingOptions()}},{key:"getSelectedShippingMethod",value:function(){return this.cart.getSelectedShippingMethod()}},{key:"getCurrency",value:function(){return this.cart.getCurrency()}},{key:"getTotal",value:function(){return this.cart.getTotal()}},{key:"getTotalCents",value:function(){return this.cart.getTotalCents()}}],n&&_(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();k(P,"attributionDataStored",!1);const O=P;function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function x(){x=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new P(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function h(){}function d(){}function p(){}var f={};c(f,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(O([])));v&&v!==e&&n.call(v,i)&&(f=v);var m=p.prototype=h.prototype=Object.create(f);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(i,o,a,c){var u=s(t[i],t,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==E(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;this._invoke=function(t,n){function o(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function O(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=p,c(m,"constructor",p),c(p,"constructor",d),d.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(b.prototype),c(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new b(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,i,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=O,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:O(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function S(t,e,n,r,i,o,a){try{var c=t[o](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,i)}function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function L(){return L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=F(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},L.apply(this,arguments)}function F(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=A(t)););return t}function T(t,e){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},T(t,e)}function R(t,e){if(e&&("object"===E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return V(t)}function V(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}function M(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&T(t,e)}(l,t);var e,n,i,o,c,u,s=(c=l,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=A(c);if(u){var n=A(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return R(this,t)});function l(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),M(V(n=s.call(this,e)),"_excludedKeys",["add-to-cart","quantity","variation_id"]),n.product=t,n}return e=l,n=[{key:"initialize",value:function(){this.actions.addAction("found_variation",this.onFoundVariation.bind(this)),this.actions.addAction("reset_variation",this.onResetVariation.bind(this)),this.setMaxWidth(),L(A(l.prototype),"initialize",this).call(this)}},{key:"onPaymentElementReady",value:function(){var t,e;L(A(l.prototype),"onPaymentElementReady",this).call(this),this.product.isVariableProduct()&&(this.product.isVariationSelected()&&null!==(t=this.product)&&void 0!==t&&null!==(e=t.variation)&&void 0!==e&&e.is_in_stock?this.enablePaymentElement():this.disablePaymentElement(!0))}},{key:"needsShipping",value:function(){return this.cart.isEmpty()?this.product.needsShipping():L(A(l.prototype),"needsShipping",this).call(this)}},{key:"getElementContainer",value:function(){var t="wc-".concat(this.id,"-product-button-container"),e=document.querySelectorAll(".".concat(t));return e&&e.length>0?e:document.getElementById(t)}},{key:"setMaxWidth",value:function(){var t,e;if("add_to_cart"==(null===(t=this.settings)||void 0===t||null===(e=t.product)||void 0===e?void 0:e.button_width)){this.buttonWidth=r()("form.cart div.quantity").outerWidth(!0)+r()(".single_add_to_cart_button").outerWidth();var n=r()(".single_add_to_cart_button").css("marginLeft");n&&(this.buttonWidth+=parseInt(n.replace("px",""))),r()(this.container).css("max-width",this.buttonWidth+"px")}}},{key:"submitError",value:function(t){this.hideProcessing(),(0,a.submitErrorMessage)(t,"div.woocommerce-notices-wrapper")}},{key:"addToCart",value:function(){var t=this;return this.cart.addToCart(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){M(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({payment_method:this.id,product_id:this.product.getId(),variation_id:this.product.getVariationId(),qty:this.product.getQuantity(),variation:this.product.getVariationData(),needs_setup_token:this.settings.needsSetupToken},(0,a.convertFormToJson)(r()("form.cart"),this._excludedKeys))).then((function(e){if(!e.code)return t._cartItemKey=e.cart_item_key,e.order_id;t.currentError=e})).catch((function(e){return t.currentError=e,t.submitError(e)}))}},{key:"createOrder",value:function(){return this.addToCart()}},{key:"createVaultSetupToken",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.addToCart().then((function(){return L(A(l.prototype),"createVaultSetupToken",t).call(t,e)}))}},{key:"removeCartItem",value:(i=x().mark((function t(){return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._cartItemKey){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.cart.removeCartItem(this._cartItemKey);case 4:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(n,r){var o=i.apply(t,e);function a(t){S(o,n,r,a,c,"next",t)}function c(t){S(o,n,r,a,c,"throw",t)}a(void 0)}))},function(){return o.apply(this,arguments)})},{key:"onFoundVariation",value:function(t,e){t?(this.destroyPaymentElement(),this.createPaymentElement()):e.variation.is_in_stock?this.enablePaymentElement():this.disablePaymentElement(!0)}},{key:"onResetVariation",value:function(){this.disablePaymentElement(!0)}},{key:"onCancel",value:function(){var t=this;this.removeCartItem().finally((function(){L(A(l.prototype),"onCancel",t).call(t)}))}},{key:"getTotal",value:function(t){return this.cart.isEmpty()?this.product.getTotal(t):L(A(l.prototype),"getTotal",this).call(this,t)}},{key:"getTotalCents",value:function(){return this.cart.isEmpty()?this.product.getTotalCents():L(A(l.prototype),"getTotalCents",this).call(this)}},{key:"getLineItems",value:function(){return this.cart.isEmpty()?this.product.getLineItems():L(A(l.prototype),"getLineItems",this).call(this)}}],n&&C(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),l}(O);function D(t){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(){return N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=q(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},N.apply(this,arguments)}function q(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=K(t)););return t}function z(t,e){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},z(t,e)}function U(t,e){if(e&&("object"===D(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function K(t){return K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},K(t)}var W=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&z(t,e)}(u,t);var e,n,i,o,c=(i=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=K(i);if(o){var n=K(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return U(this,t)});function u(){return G(this,u),c.apply(this,arguments)}return e=u,(n=[{key:"initialize",value:function(){this.actions.addAction("cart_updated",this.onCartUpdated.bind(this)),r()(window).on("resize",this.doCartHtml.bind(this)),r()(document).on("change",'input[name^="shipping_method"]',this.onShippingSelected.bind(this)),N(K(u.prototype),"initialize",this).call(this),this.doCartHtml()}},{key:"getElementContainer",value:function(){return document.getElementById("wc-".concat(this.id,"-cart-button-container"))}},{key:"onCartUpdated",value:function(t){N(K(u.prototype),"initialize",this).call(this),this.doCartHtml()}},{key:"onShippingSelected",value:function(){this.storeAttributionValues()}},{key:"submitError",value:function(t){this.hideProcessing(),(0,a.submitErrorMessage)(t,"div.woocommerce-notices-wrapper","checkout")}},{key:"doCartHtml",value:function(){var t=r()(".checkout-button"),e=t.outerWidth();e&&r()(".wc-ppcp-cart-payments__container").length&&r()(".wc-ppcp-cart-payments__container").width(e),"none"!==t.css("float")&&r()(".wc-ppcp-cart-payments__container ").css("float",t.css("float"))}},{key:"onPaymentElementReady",value:function(){N(K(u.prototype),"onPaymentElementReady",this).call(this),r()(".wc-ppcp-cart-payments__container").show()}}])&&I(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(O);const Y=window.wcPPCP.paymentMethods;function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function $(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function J(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$(Object(n),!0).forEach((function(e){Q(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Q(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function X(){X=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new P(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function h(){}function d(){}function p(){}var f={};c(f,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(O([])));v&&v!==e&&n.call(v,i)&&(f=v);var m=p.prototype=h.prototype=Object.create(f);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(i,o,a,c){var u=s(t[i],t,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==H(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;this._invoke=function(t,n){function o(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function O(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return d.prototype=p,c(m,"constructor",p),c(p,"constructor",d),d.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(b.prototype),c(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new b(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,i,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=O,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:O(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function Z(t,e,n,r,i,o,a){try{var c=t[o](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,i)}function tt(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){Z(o,r,i,a,c,"next",t)}function c(t){Z(o,r,i,a,c,"throw",t)}a(void 0)}))}}function et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nt(){return nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=rt(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},nt.apply(this,arguments)}function rt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=at(t)););return t}function it(t,e){return it=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},it(t,e)}function ot(t,e){if(e&&("object"===H(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function at(t){return at=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},at(t)}var ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&it(t,e)}(d,t);var e,n,i,u,s,l,h=(s=d,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=at(s);if(l){var n=at(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return ot(this,t)});function d(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d),(e=h.call(this,t)).order=t.order,e.shippingAddressChanged=!1,e.promises=[],e}return e=d,n=[{key:"initialize",value:function(){nt(at(d.prototype),"initialize",this).call(this),this.actions.addAction("updated_checkout",this.updatedCheckout.bind(this)),r()(document.body).on("update_checkout",this.updateCheckout.bind(this)),this.context.isCheckout()?(r()(document.body).on("payment_method_selected",this.paymentMethodSelected.bind(this)),r()("form.checkout").on("checkout_place_order_".concat(this.id),this.onCheckoutPlaceOrder.bind(this))):(r()(document.body).on("change",'input[name="payment_method"]',this.paymentMethodSelected.bind(this)),r()(document.body).on("click","#place_order",this.onClickPlaceOrder.bind(this))),r()(document.body).on("checkout_error",this.onCheckoutError.bind(this)),r()(document.body).on("click",".wc-".concat(this.gateway.id,"-cancel__payment"),this.cancelPayment.bind(this)),r()(document.body).on("change",'[name="terms"]',this.handleTermsClick.bind(this)),r()(document.body).on("change",'[type="checkbox"]',this.handleCheckboxChange.bind(this)),r()(document.body).on("change",'[name="wc-'.concat(this.id,'-payment-token"]'),this.onPaymentTokenClick.bind(this)),window.addEventListener("hashchange",this.handleHashError.bind(this)),this.handleOrderPay()}},{key:"createPaymentElement",value:(u=tt(X().mark((function t(){var e=this;return X().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(this.promises);case 2:if(this.promises=[],!this.context.isCheckout()||this.isEnabledForCheckoutSection()){t.next=6;break}return this.hidePaymentMethodRow(),t.abrupt("return");case 6:nt(at(d.prototype),"createPaymentElement",this).call(this).then((function(){e.paymentMethodSelected()}));case 7:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"isEnabledForCheckoutSection",value:function(){var t,e,n;return null===(t=null===(e=this.gateway.settings)||void 0===e||null===(n=e.sections)||void 0===n?void 0:n.includes("checkout"))||void 0===t||t}},{key:"hidePaymentMethodRow",value:function(){this.context.isOrderPay()?r()("form#order_review li.payment_method_".concat(this.id)).hide():r()("form.checkout li.payment_method_".concat(this.id)).hide()}},{key:"onPaymentUnavailable",value:function(){var t,e,n,i;if(nt(at(d.prototype),"onPaymentUnavailable",this).call(this),this.configurationError){var o=(0,a.isAdminUser)()?(null===(t=this.gateway.settings)||void 0===t||null===(e=t.i18n)||void 0===e?void 0:e.unavailable_admin)||this.configurationError:(null===(n=this.gateway.settings)||void 0===n||null===(i=n.i18n)||void 0===i?void 0:i.unavailable)||"Payment method unavailable",c=r()("div.payment_method_".concat(this.id)).find(".wc-".concat(this.id,"-payment-method__container"));c.find(".woocommerce-info").remove(),c.prepend('<div class="woocommerce-info"><p>'.concat(o,"</p></div>"))}else this.hidePaymentMethodRow()}},{key:"needsShipping",value:function(){return this.context.isOrderPay()?this.order.needsShipping():!this.context.isAddPaymentMethod()&&this.cart.needsShipping()}},{key:"getCurrency",value:function(){return this.context.isOrderPay()?this.order.getCurrency():nt(at(d.prototype),"getCurrency",this).call(this)}},{key:"getTotal",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"string";return this.context.isOrderPay()?this.order.getTotal():nt(at(d.prototype),"getTotal",this).call(this,t)}},{key:"getTotalCents",value:function(){return this.context.isOrderPay()?this.order.getTotalCents():nt(at(d.prototype),"getTotalCents",this).call(this)}},{key:"getLineItems",value:function(){return this.context.isOrderPay()?this.order.getLineItems():nt(at(d.prototype),"getLineItems",this).call(this)}},{key:"updatedCheckout",value:function(t){nt(at(d.prototype),"initialize",this).call(this),this.paymentMethodSelected(),(this.isOrderReview()||this.isReadyToCheckout())&&this.displayPaymentReadyMessage()}},{key:"updateCheckout",value:function(){this.promises.push(new Promise((function(t){r()(document.body).one("updated_checkout",(function(){t()}))})))}},{key:"paymentMethodSelected",value:function(){if(this.isPaymentGatewaySelected()){if(!this.isPaymentMethodAvailable)return void this.displayPlaceOrderButton();this.gateway.supports("place_order_button")?(this.displayPlaceOrderButton(),this.isReadyToCheckout()&&this.isPaymentSectionPlacement()&&this.hidePaymentElement()):this.isReadyToCheckout()||this.isSavedPaymentMethodSelected()?this.displayPlaceOrderButton():(this.displayPaymentElement(),this.hidePlaceOrderButton())}else if(!this.gateway.supports("place_order_button")){var t;this.hidePaymentElement();var e=null===(t=r()('[name="payment_method"]:checked'))||void 0===t?void 0:t.val();e&&!(0,Y.getPaymentMethod)(e)&&this.displayPlaceOrderButton()}}},{key:"handleHashError",value:function(t){var e=t.newURL.match(/ppcp_error=(.*)/);e&&"true"==e[1]&&(this.displayPaymentElement(),history.pushState({},"",window.location.pathname+window.location.search))}},{key:"isOrderReview",value:function(){var t,e,n,r=null===(t=window)||void 0===t||null===(e=t.location)||void 0===e||null===(n=e.search)||void 0===n?void 0:n.match(/_ppcp_order_review=(.*)/);return(null==r?void 0:r.length)>0}},{key:"handleOrderPay",value:function(){if(this.isOrderReview())try{var t,e,n,i,o=(null===(t=window)||void 0===t||null===(e=t.location)||void 0===e||null===(n=e.search)||void 0===n?void 0:n.match(/_ppcp_order_review=(.*)/))[1],u=JSON.parse(atob(decodeURIComponent(o))),s=(u.payment_method,u.paypal_order),l=u.fields;if((0,a.setFieldValue)(this.order_field_key,s,""),!(0,c.isEmpty)(l))for(var h in l)(0,a.setFieldValue)(h,l[h],"");if(this.hidePaymentElement(),this.needsShipping()&&null!==(i=r()('[name="ship_to_different_address"]'))&&void 0!==i&&i.length){var d=!(0,c.isEqual)(this.getCartAddress("billing"),this.getCartAddress("shipping"));r()('[name="ship_to_different_address"]').prop("checked",d).trigger("change")}}catch(t){console.log(t)}}},{key:"createOrder",value:function(t,e){if(this.context.isOrderPay())return this.order.createOrder(this.id);var n=J(J({},this.convertFormToData()),{},{context:this.context.getPage(),payment_method:this.id});return this.cart.createOrder(n)}},{key:"createVaultSetupToken",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.context.isOrderPay()||(t=J(J({},this.convertFormToData()),{},{context:this.context.getPage(),payment_method:this.id})),nt(at(d.prototype),"createVaultSetupToken",this).call(this,t)}},{key:"displayPlaceOrderButton",value:function(){var t;null===(t=this.getPlaceOrderButton())||void 0===t||t.removeClass("wc-ppcp-hide-button")}},{key:"hidePlaceOrderButton",value:function(){var t;null===(t=this.getPlaceOrderButton())||void 0===t||t.addClass("wc-ppcp-hide-button")}},{key:"getPlaceOrderButton",value:function(){var t=r()("#place_order");return t.length||(t=r()('[name="woocommerce_checkout_place_order"]')),t.length||(t=r()('form.checkout button[type="submit"]')),t.length||(t=r()('form[id="order_review"] button[type="submit"]')),t}},{key:"getButtonPlacement",value:function(){var t;return(null===(t=this.settings)||void 0===t?void 0:t.buttonPlacement)||"place_order"}},{key:"isPlaceOrderPlacement",value:function(){return"place_order"===this.getButtonPlacement()}},{key:"isPaymentSectionPlacement",value:function(){return"payment_method"===this.getButtonPlacement()}},{key:"getElementContainer",value:function(){if(this.paymentElementSelector)return document.querySelector(this.paymentElementSelector);var t=this.getButtonPlacement(),e="wc-".concat(this.id,"-checkout-container"),n=".".concat(e),i="place_order"===t&&!this.gateway.supports("place_order_button");return document.querySelector(n)||(i?this.getPlaceOrderButton().after('<div class="'.concat(e,'"></div>')):"payment_method"===t&&r()("div.payment_method_".concat(this.id)).find(".wc-".concat(this.id,"-payment-method__container")).append('<div class="'.concat(e,'"></div>'))),i&&r()(n).hide(),document.querySelector(n)}},{key:"isPaymentGatewaySelected",value:function(){var t;return(null===(t=r()('[name="payment_method"]:checked'))||void 0===t?void 0:t.val())===this.id}},{key:"submitError",value:function(t){return"validation_errors"===(null==t?void 0:t.code)?(this.getForm().find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),(0,a.submitErrorMessage)(t.data.messages,this.getForm(),"checkout")):(0,a.submitErrorMessage)(t,this.getForm(),"checkout")}},{key:"getShippingPrefix",value:function(){var t;return null!==(t=r()('[name="ship_to_different_address"]'))&&void 0!==t&&t.length&&r()('[name="ship_to_different_address"]').is(":checked")?"shipping":"billing"}},{key:"isCheckoutReviewRequired",value:function(t){return!(!this.needsShipping()||!this.actions.applyFilters("is_checkout_review_required",!this.shippingAddressChanged,this)||(0,c.isEmpty)(t.shipping_address)||(0,c.isEqual)({city:t.shipping_address.city,state:t.shipping_address.state,postal_code:t.shipping_address.postal_code,country_code:t.shipping_address.country_code},{city:(0,a.getFieldValue)("shipping_city"),state:(0,a.getFieldValue)("shipping_state"),postal_code:(0,a.getFieldValue)("shipping_postcode"),country_code:(0,a.getFieldValue)("shipping_country")}))}},{key:"getForm",value:function(){return this.context.isCheckout()||this.context.isExpressCheckout()?r()(this.container).closest("form.checkout"):r()(this.container).closest("form")}},{key:"validateTerms",value:function(){return!r()('[name="terms"]').filter(":visible").length||r()('[name="terms"]').is(":checked")}},{key:"onClickPlaceOrder",value:function(t){this.isPaymentGatewaySelected()&&(this.onCheckoutPlaceOrder(t,null)||t.preventDefault())}},{key:"onCheckoutPlaceOrder",value:function(t){var e,n,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isSavedPaymentMethodSelected())return!0;if(this.isReadyToCheckout()||null!==(e=(n=this.gateway).isPaymentReady)&&void 0!==e&&e.call(n))return!0;if(!this.validateSync())return!1;if(this.gateway.supports("place_order_button")&&this.isPaymentSectionPlacement()&&!this.isReadyToCheckout())return this.submitError((0,a.getErrorMessage)({code:"order_button_click"}).replace("%s",this.gateway.settings.title)),!1;try{this.gateway.validatePaymentElement()}catch(t){return this.submitError(t),!1}return!this.gateway.supports("create_payment_method")||(this.gateway.createPaymentMethod(i).catch((function(t){r.submitError(t)})),!1)}},{key:"isTermsVisible",value:function(){return r()('[name="terms"]').filter(":visible").length>0}},{key:"handleTermsClick",value:function(){this.isPlaceOrderPlacement()&&this.gateway.supports("disable_for_terms")&&r()('[name="terms"]').filter(":visible").length&&(r()('[name="terms"]').is(":checked")?this.enablePaymentElement():this.disablePaymentElement())}},{key:"handleCheckboxChange",value:function(){var t=this;setTimeout((function(){t.isTermsVisible()&&t.handleTermsClick()}),250)}},{key:"onPaymentTokenClick",value:function(t){this.isSavedPaymentMethodSelected()?(this.hidePaymentElement(),this.displayPlaceOrderButton()):(this.displayPaymentElement(),this.gateway.supports("place_order_button")||this.hidePlaceOrderButton())}},{key:"validateSync",value:function(){return!(this.isPlaceOrderPlacement()&&!this.validateTerms()&&(this.submitError({code:"terms"}),1))}},{key:"validate",value:(i=tt(X().mark((function t(){var e=this;return X().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.validateSync()){t.next=2;break}return t.abrupt("return",!1);case 2:if(!this.context.isCheckout()){t.next=18;break}if(t.prev=3,!this.gateway.supports("api_form_validation")){t.next=7;break}return t.next=7,this.apiFormValidation();case 7:if(!this.gateway.supports("form_validation")){t.next=12;break}if(this.isCheckoutFormValid()){t.next=12;break}return this.disablePaymentElement(!0),t.next=12,this.apiFormValidation().finally((function(){e.enablePaymentElement()}));case 12:t.next=18;break;case 14:return t.prev=14,t.t0=t.catch(3),this.submitError(t.t0),t.abrupt("return",!1);case 18:return t.abrupt("return",!0);case 19:case"end":return t.stop()}}),t,this,[[3,14]])}))),function(){return i.apply(this,arguments)})},{key:"onShippingChange",value:function(t){var e;if(null!==(e=t)&&void 0!==e&&e.shipping_method)for(var n=(0,a.extractShippingMethod)(t.shipping_method),i=0,o=Object.keys(n);i<o.length;i++){var u=o[i],s=n[u],l=r()('[name="shipping_method['.concat(u,']"][value="').concat(s,'"]'));l.length?l.prop("checked",!0):this.update_required=!0}return t.address&&(this.shippingAddressChanged=!(0,c.isEqual)(t.address,{city:(0,a.getFieldValue)("shipping_city"),state:(0,a.getFieldValue)("shipping_state"),postcode:(0,a.getFieldValue)("shipping_postcode"),country:(0,a.getFieldValue)("shipping_country")})),t=J(J({},this.convertFormToData()),t),this.actions.doAction("checkout_on_shipping_change",t,this),nt(at(d.prototype),"onShippingChange",this).call(this,t)}},{key:"displayPaymentReadyMessage",value:function(){r()(".wc-".concat(this.gateway.id,"-popup__container")).hide(),r()(".wc-".concat(this.gateway.id,"-order-review-message__container")).show();var t=r()(".wc-".concat(this.gateway.id,"-order-review__message")).text().replace("%s",r()("#place_order").text());r()(".wc-".concat(this.gateway.id,"-order-review__message")).text(t)}},{key:"hidePaymentReadyMessage",value:function(){r()(".wc-".concat(this.gateway.id,"-popup__container")).show(),r()(".wc-".concat(this.gateway.id,"-order-review-message__container")).hide()}},{key:"cancelPayment",value:function(t){t.preventDefault(),(0,a.setFieldValue)(this.order_field_key,"",""),(0,a.setFieldValue)("".concat(this.gateway.id,"_payment_token"),null,null),this.hidePaymentReadyMessage(),this.displayPaymentElement(),this.gateway.supports("place_order_button")||this.hidePlaceOrderButton()}},{key:"getProcessingSelector",value:function(){return this.container}},{key:"getProcessingMessage",value:function(){return null}},{key:"fetchBillingToken",value:function(t){var e=this;return this.showProcessing(),nt(at(d.prototype),"fetchBillingToken",this).call(this,t).then((function(t){return e.hideProcessing(),t}))}},{key:"isReadyToCheckout",value:function(){return!(!(0,a.getFieldValue)(this.order_field_key,null)&&!(0,a.getFieldValue)("".concat(this.gateway.id,"_payment_token"),null))}},{key:"convertFormToData",value:function(){return(0,a.convertFormToJson)(r()("form.checkout"))}},{key:"submit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&this.populateCheckoutFields(t),this.gateway.supports("create_payment_method")||(this.hidePaymentElement(),this.displayPlaceOrderButton()),this.update_required?this.triggerCheckoutUpdate(t):(this.isPaymentSectionPlacement()&&!this.context.isExpressCheckout()||this.submitForm(t),this.isPaymentSectionPlacement()&&this.displayPaymentReadyMessage())}},{key:"triggerCheckoutUpdate",value:function(t){var e=this;return new Promise((function(n){r()(document.body).one("updated_checkout",(function(){null!=t&&t.vaultSetupToken&&e.needsShipping()?e.displayPaymentReadyMessage():e.submitForm(t),n()})),r()('[name="billing_country"],[name="billing_state"]').trigger("change"),e.shipToDifferentAddressChecked()&&r()('[name="shipping_country"],[name="shipping_state"]').trigger("change"),r()(document.body).trigger("update_checkout",{update_shipping_method:!1})}))}},{key:"submitForm",value:function(t){this.actions.applyFilters("checkout_submit_form",!0,t,this)&&this.getForm().submit()}},{key:"shipToDifferentAddressChecked",value:function(){var t;return!(null===(t=r()('[name="ship_to_different_address"]'))||void 0===t||!t.length)&&r()('[name="ship_to_different_address"]').is(":checked")}},{key:"getPaymentType",value:function(){return"checkout"}},{key:"isValidationEnabled",value:function(){return this.settings.checkoutValidationEnabled}},{key:"isSavedPaymentMethodSelected",value:function(){var t='[name="wc-'.concat(this.id,'-payment-token"]:checked');return this.isPaymentGatewaySelected()&&r()(t).length>0&&"new"!==r()(t).val()}},{key:"apiFormValidation",value:function(){var t=J(J({},this.convertFormToData()),{},{context:this.context.getPage(),payment_method:this.id});return o()({method:"POST",url:(0,a.getRestRoute)("checkout/validation"),data:t}).catch((function(t){throw t}))}},{key:"onCheckoutError",value:function(){this.isPaymentGatewaySelected()&&(this.enablePlaceOrderButton(),this.isReadyToCheckout()&&this.displayPaymentReadyMessage(),this.actions.doAction("checkout_error_".concat(this.gateway.id),this))}},{key:"enablePlaceOrderButton",value:function(){this.getPlaceOrderButton().prop("disabled",!1)}},{key:"isCheckoutFormValid",value:function(){var t=[];return r()(".validate-required:visible").each((function(e,n){var i=r()(n).find("input, select, textarea").first();if(i.length&&i.is(":visible")){var o=i.attr("name");"checkbox"===i.attr("type")?i.is(":checked")||t.push(o):""!==i.val()&&null!==i.val()||t.push(o)}})),0===t.length}}],n&&et(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),d}(O);function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function st(){st=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new P(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function h(){}function d(){}function p(){}var f={};c(f,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(O([])));v&&v!==e&&n.call(v,i)&&(f=v);var m=p.prototype=h.prototype=Object.create(f);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(i,o,a,c){var u=s(t[i],t,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==ut(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;this._invoke=function(t,n){function o(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function O(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return d.prototype=p,c(m,"constructor",p),c(p,"constructor",d),d.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(b.prototype),c(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new b(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),c(m,a,"Generator"),c(m,i,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=O,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:O(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function lt(t,e,n,r,i,o,a){try{var c=t[o](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,i)}function ht(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){lt(o,r,i,a,c,"next",t)}function c(t){lt(o,r,i,a,c,"throw",t)}a(void 0)}))}}function dt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ft(){return ft="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=yt(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},ft.apply(this,arguments)}function yt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=gt(t)););return t}function vt(t,e){return vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},vt(t,e)}function mt(t,e){if(e&&("object"===ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function gt(t){return gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gt(t)}var bt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vt(t,e)}(c,t);var e,n,i,o,a=(i=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gt(i);if(o){var n=gt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return mt(this,t)});function c(){return dt(this,c),a.apply(this,arguments)}return e=c,n=[{key:"initialize",value:function(){var t=this;this.actions.addAction("updated_checkout",this.updatedCheckout.bind(this)),this.loadPayPalScript().then(ht(st().mark((function e(){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.createPaymentElement();case 1:case"end":return e.stop()}}),e)}))))}},{key:"updatedCheckout",value:function(t){this.paypal&&this.createPaymentElement(),this.updateGatewaySettings(t)}},{key:"needsShipping",value:function(){return this.cart.needsShipping()}},{key:"validate",value:function(){return!0}},{key:"submit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;ft(gt(c.prototype),"submit",this).call(this,t);var e=ft(gt(c.prototype),"getElementContainer",this).call(this);e&&r()(e).hide()}},{key:"getElementContainer",value:function(){var t;if(null!==(t=this.settings)&&void 0!==t&&t.expressElement){var e=document.querySelector(this.settings.expressElement);if(e)return e}return document.getElementById("wc-".concat(this.id,"-express-button"))}},{key:"onPaymentElementReady",value:function(){this.actions.doAction("payment_element_ready",this);var t=this.getElementContainer();t&&(r()(t).show(),this.addExpressClasses(r()(t))),r()(".wc-ppcp-express-checkout").show()}},{key:"addExpressClasses",value:function(t){if(t.length&&this.gateway.buttons){var e=Object.keys(this.gateway.buttons).length;t.addClass("button-count_".concat(e))}}},{key:"onClick",value:function(){r()('[name="terms"]').prop("checked",!0).trigger("change"),r()('[name="payment_method"][value="'.concat(this.id,'"]')).prop("checked",!0).trigger("click"),r()('[name="wc-'.concat(this.id,'-payment-token"][value="new"]')).trigger("click")}},{key:"paymentMethodSelected",value:function(){}},{key:"hidePaymentElement",value:function(){}}],n&&pt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(ct);function wt(t){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wt(t)}function _t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pt(){return Pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=Ot(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Pt.apply(this,arguments)}function Ot(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=St(t)););return t}function Et(t,e){return Et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Et(t,e)}function xt(t,e){if(e&&("object"===wt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function St(t){return St=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},St(t)}var jt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Et(t,e)}(c,t);var e,n,i,o,a=(i=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=St(i);if(o){var n=St(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return xt(this,t)});function c(){return _t(this,c),a.apply(this,arguments)}return e=c,(n=[{key:"initialize",value:function(){this.actions.addAction("fragments_changed",this.onFragmentsChanged.bind(this)),Pt(St(c.prototype),"initialize",this).call(this)}},{key:"onFragmentsChanged",value:function(){this.cart.isEmpty()||Pt(St(c.prototype),"initialize",this).call(this)}},{key:"getElementContainer",value:function(){var t=document.querySelectorAll(".wc-ppcp-minicart-".concat(this.id));return t&&t.length>0?t:(r()(".woocommerce-mini-cart__buttons").append('<a id="wc-ppcp-minicart-'.concat(this.id,'"></a>')),document.getElementById("wc-ppcp-minicart-".concat(this.id)))}}])&&kt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(O);(this.wcPPCP=this.wcPPCP||{}).controllers=e})();
//# sourceMappingURL=controllers.js.map